<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Anand Sainath">

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="{{ url_for('static', filename='lib/bootstrap/css/bootstrap.min.css') }}">
	<!-- Custom styles for this template -->
	<link rel="stylesheet" href="{{ url_for('static', filename='lib/bootstrap/css/starter-template.css') }}">    

	<title>List View</title>
	<style type="text/css">

	.grid{
		position: relative;
		width: 100%;
		height: 675px;
		margin: 0 0 0 0;
		padding-top: 10px;
		background: #FAFAFA;
		overflow: hidden;
		overflow-x: scroll;
	}

	.list-container{
		position: absolute;
    	width: 1300px;
    	height: 550px;
	}

	.col-1-4 {
		margin-left: 10px;
		width: 325px;
		padding: 0px;
		float: left;
	}

	.col-space{
		width: 100px;
		height: 550px;
		float: left;
	}

	.restrict {
		overflow-x: hidden;
		overflow-y: scroll;
		height: 550px;
	}

	.top-margin-10{
		margin-top: 10px;
	}

	.padding-right-25{
		padding-right: 25px;
	}

	.panel-heading{
		padding: 7px 2px;
	}

	.btn-sm, .btn-group-sm>.btn {
		padding: 5px 10px;
	}

	ol, ul {
		list-style-type: none;
		margin: 0px;
		padding: 0px;
	}

	ul li{
		border-bottom: 1px solid #CCC;
	}

	.panel-body{
		padding: 0px;
	}

	.js-scroll-list::-webkit-scrollbar {
	    -webkit-appearance: none;
	    width: 7px;
	}
	.js-scroll-list::-webkit-scrollbar-thumb {
	    border-radius: 4px;
	    background-color: rgba(0,0,0,.5);
	    -webkit-box-shadow: 0 0 1px rgba(255,255,255,.5);
	}

	.grid::-webkit-scrollbar {
	    -webkit-appearance: none;
	    height: 7px;
	}
	.grid::-webkit-scrollbar-thumb {
	    border-radius: 4px;
	    background-color: rgba(0,0,0,.5);
	    -webkit-box-shadow: 0 0 1px rgba(255,255,255,.5);
	}

	.bar-container{
		margin: 3px 0px;
		height: 14px;
		background: black;
	}

	.bar{
		background: white;
		height: 14px;
	}

	.modal {
	    display:    none;
	    position:   fixed;
	    z-index:    1000;
	    top:        0;
	    left:       0;
	    height:     100%;
	    width:      100%;
	    background: rgba( 255, 255, 255, .8 ) 
	        url('/static/images/loading.gif') 
	        50% 50% 
	        no-repeat;
	}

	.ellipsize{
		white-space: nowrap;
		overflow: hidden;
	}
	</style>
</head>
<body>

	<div class="modal"></div>
	{% macro render_list(headers, list_content) %}
		<div class="panel panel-default">
			<div class="panel-heading">
				<div>
					<div class="row">
						<div class="col-xs-6 js-tooltip" data-toggle="tooltip" data-placement="bottom" title="Select item type to be shown in the list"  style="padding-right: 5px; padding-left: 20px;">
							<select class="form-control">
								{% for header in headers %}
									<option>{{header}}</option>
								{% endfor %}
							</select>
						</div>
						<div class="col-xs-3 js-tooltip" data-toggle="tooltip" data-placement="bottom" title="Add all items of the selected type to the list">
							<button type="button" class="btn btn-default">Add all</button>
						</div>
						<div class="col-xs-3 js-tooltip pull-left" data-toggle="tooltip" data-placement="bottom" title="Clear list" style="padding-left: 5px;">
							<button type="button" class="btn btn-default">Clear</button>
						</div>
					</div>
					<div class="row top-margin-10">
						<div class="col-xs-12" style="padding-left: 20px;">
							<div class="btn-group">
								<button type="button" class="btn btn-default btn-sm js-tooltip js-sort-alphabetically" data-toggle="tooltip" data-placement="top" title="Sort list alphabetically">
									<span class="glyphicon glyphicon-sort-by-alphabet"></span>
								</button>
								<button type="button" class="btn btn-default btn-sm js-tooltip js-sort-by-frequency" data-toggle="tooltip" data-placement="top" title="Sort list by frequency">
									<span class="glyphicon glyphicon-sort-by-attributes-alt"></span>
								</button>
								<button type="button" class="btn btn-default btn-sm js-tooltip" data-toggle="tooltip" data-placement="top" title="Sort list by connection strength">
									<span class="glyphicon glyphicon-align-justify"></span>
								</button>
							</div>

							|

							<div class="btn-group">
								<button type="button" class="btn btn-default btn-sm js-tooltip js-active-top" data-toggle="tooltip" data-placement="top" title="Bring active elements to the top of the list">
									<span class="glyphicon glyphicon-arrow-up"></span>
								</button>
							</div>

							|

							<div class="btn-group">
								<button type="button" class="btn btn-default btn-sm js-tooltip js-clear-selection" data-toggle="tooltip" data-placement="top" title="Clear Selection">
									<span class="glyphicon glyphicon-remove"></span>
								</button>
							</div>

							|

							<div class="btn-group">
								<button type="button" class="btn btn-default btn-sm js-tooltip js-align-left active" data-toggle="tooltip" data-placement="top" title="Align Left">
									<span class="glyphicon glyphicon-align-left"></span>
								</button>
								<button type="button" class="btn btn-default btn-sm js-tooltip js-align-center" data-toggle="tooltip" data-placement="top" title="Center">
									<span class="glyphicon glyphicon-align-center"></span>
								</button>
								<button type="button" class="btn btn-default btn-sm js-tooltip js-align-right" data-toggle="tooltip" data-placement="top" title="Align Right">
									<span class="glyphicon glyphicon-align-right"></span>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="panel-body restrict js-scroll-list">
				<ul>
					{% for item in list_content %}
					<li class="row" data-frequency="{{item.1}}" data-item="{{item.0}}">
						<div class="col-xs-2 bar-container">
							<div class="bar" style="width: {{item.1}}%"></div>
						</div>
						<span class="col-xs-10 padding-right-25 ellipsize">{{item.0}}</span>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	{% endmacro %}

	<div class="grid">
		<div class="list-container">
			{% for list in lists %}
				<div class="js-list col-1-4">
					{{ render_list(headers, list) }}
				</div>
				<div class="col-space"></div>
			{% endfor %}
		</div>
	</div>

		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script type="text/javascript" src="{{ url_for('static', filename='lib/jquery-2.1.1.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='lib/bootstrap/js/bootstrap.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='lib/d3.v3.js') }}"></script>

		<script type="text/javascript">

		var currentSelection = "#FEF935";
		//var seedSelectionColorSwatch = ["#fff5eb", "#fee6ce", "#fdd0a2", "#fdae6b", "#fd8d3c", "#f16913"];
		var seedSelectionColorSwatch = ["#ffdc8c", '#ffd278','#ffc864','#ffbe50','#ffb43c','#ffaa28','#ffa014','#ff9600'];
		
		var selectionColors = d3.scale.linear()
                    .domain(d3.range(0, 1, 1.0 / (seedSelectionColorSwatch.length - 1)))
                    .range(seedSelectionColorSwatch);
            
		$(function(){

			$('ul:eq(1) > li > span').click(function(){
				var author = $(this).text().trim();
				$.ajax({
					type:'post',
					contentType: 'application/json; charset=utf-8',
					url:'/list/get-selections',
					dataType: 'json',
					data: JSON.stringify({'current':'Author','selection': author, 'related':['Year','Conference']}),
					success: function(data){
						console.log(data[0].values, data[1].values);
						$year = $('ul:first');
						$year.find('li > span').css({"background": "#FFFFFF"});
						var yearValues = data[0].values;
						var obj;
						for(var index in yearValues){
							obj = yearValues[index];
							$year.find('li[data-item="'+obj._id+'"] > span').css({"background": selectionColors(obj.count)});
						}

						$conference = $('ul:last');
						$conference.find('li > span').css({"background": "#FFFFFF"});
						var conferenceValues = data[1].values;
						for(var index in conferenceValues){
							obj = conferenceValues[index];
							$conference.find('li[data-item="'+obj._id+'"] > span').css({"background": selectionColors(obj.count)});
						}
					}
				});
			});			

			$('.js-tooltip').tooltip({
				container: 'body'
			});

			$(document).on("click",".js-sort-by-frequency", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$(this).addClass('active').siblings('button').removeClass('active');
				showLoader($ul);
				
				window.setTimeout(function(){
					if(!$ul.data('sort-frequency')){
						//attribute is either false or undefined
						//either ways, sort alphabetically from A-Z
						$ul.append(($ul.find('li').sort(sort_frequency_ascending)));
						resetAllSort($ul);
						$ul.data('sort-frequency', true);
					}

					/*$ul.find('li:first span').css({"background":currentSelection});
					var index = 2;
					var val = 1;
					while(val >= 0){
						$ul.find('li:nth-child('+index+') span').css({"background": selectionColors(val)});
						val -= 0.04;
						index++;
					}*/

					hideLoader();
				}, 0);
				
				function sort_frequency_ascending(a, b){
					return (parseInt($(b).data('frequency')) < parseInt($(a).data('frequency')))?1:-1;
				}
			});

			$(document).on("click",".js-sort-alphabetically", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$(this).addClass('active').siblings('button').removeClass('active');
				showLoader($ul);

				window.setTimeout(function(){
					if(!$ul.data('sort-item')){
						//attribute is either false or undefined
						//either ways, sort alphabetically from A-Z
						$ul.append(($ul.find('li').sort(sort_a_to_z)));
						resetAllSort($ul);
						$ul.data('sort-item', true);
					}
					hideLoader();
				}, 0);

				function sort_a_to_z(a, b){
				    return ($(b).data('item')) < ($(a).data('item')) ? 1 : -1;    
				}
			});

			$(document).on("click", ".js-align-left", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$(this).addClass('active').siblings('button').removeClass('active');
				
				var currentAlign = $ul.data('align');
				if(currentAlign !== "left" && currentAlign !== undefined){
					//align everythin left..
					$ul.find('li > span').removeClass('text-'+currentAlign).addClass('text-left');
					$ul.data('align', 'left');
				}
			});

			$(document).on("click", ".js-align-center", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$(this).addClass('active').siblings('button').removeClass('active');

				var currentAlign = $ul.data('align');
				if(currentAlign !== "center"){
					//align everythin center..
					if(currentAlign){
						$ul.find('li > span').removeClass('text-'+currentAlign);	
					}
					$ul.find('li > span').addClass('text-center');
					$ul.data('align', 'center');
				}
			});

			$(document).on("click", ".js-align-right", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$(this).addClass('active').siblings('button').removeClass('active');

				var currentAlign = $ul.data('align');
				if(currentAlign !== "right"){
					//align everythin right..
					if(currentAlign){
						$ul.find('li > span').removeClass('text-'+currentAlign);	
					}
					$ul.find('li > span').addClass('text-right');
					$ul.data('align', 'right');
				}
			});

			$(document).on("click", ".js-clear-selection", function(){
				$ul = $(this).parents('div.panel-heading:first').siblings('.panel-body').find('ul');
				$ul.find('li > span').css({"background": "#FFFFFF"});
			});

			$(document).on("click", ".js-active-top", function(){
				$(this).addClass('active');
			});
		});

		function resetAllSort($ul){
			var sorterAttributes = $ul.data();
			for(attribute in sorterAttributes){
				$ul.data(attribute, false);
			}
		}

		function showLoader($ul){
			$('.modal').css($ul.offset())
				.css({"width": $ul.outerWidth(), "height": 550})
				.show();
		}

		function hideLoader(){
			$('.modal').hide();
		}

		</script>

	</body>
	</html>